# @package _global_

# AC Predictor Model Configuration
# Action-Conditioned Vision Transformer Predictor from V-JEPA2
#
# IMPORTANT: num_timesteps refers to ENCODED timesteps from precomputed features,
# NOT original video frames. For V-JEPA2 with tubelet_size=2:
#   num_timesteps = original_frames // 2 (e.g., 16 frames -> 8 timesteps)

defaults:
  - /model/_empty  # Override empty default

model:
  _target_: src.models.ac_predictor.ACPredictorModule

  # Model architecture
  img_size: [256, 256]
  patch_size: 16
  num_timesteps: 8  # Encoded timesteps (16 original frames / tubelet_size=2)
  embed_dim: 1024
  predictor_embed_dim: 384
  depth: 24
  num_heads: 16
  mlp_ratio: 4.0
  action_embed_dim: 7  # 7D: position (3), orientation (3), gripper (1)
  use_rope: true
  is_frame_causal: true
  use_activation_checkpointing: false
  use_extrinsics: false

  # Dropout / regularization
  drop_rate: 0.0
  attn_drop_rate: 0.0
  drop_path_rate: 0.1

  # Loss settings (max T_teacher = num_timesteps - 1 = 7)
  T_teacher: 7  # Teacher-forcing prediction steps
  jump_k: 3   # Number of candidate jump targets (Ï„ sampled from last k frames)
  loss_weight_teacher: 1.0
  loss_weight_jump: 1.0
  normalize_reps: true  # Apply layer norm after predictor steps (V-JEPA2 paper)
  loss_type: "l1"  # Loss function: "l1" (MAE), "l2" (MSE), or "huber"
  huber_delta: 1.0  # Delta for Huber loss (only used when loss_type="huber")

  # Curriculum learning schedule (null = disabled, use fixed values above)
  # Example schedule to enable:
  #   curriculum_schedule:
  #     - epoch: 0
  #       jump_k: 2
  #       loss_weight_teacher: 1.0
  #     - epoch: 10
  #       jump_k: 4
  #       loss_weight_teacher: 0.5
  curriculum_schedule: null

  # Optimizer settings
  learning_rate: 1e-4
  weight_decay: 0.05
  betas: [0.9, 0.999]
  warmup_epochs: 10
  max_epochs: ${trainer.max_epochs}
